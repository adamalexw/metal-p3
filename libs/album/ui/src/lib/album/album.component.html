<ng-container *ngIf="album">
  <nav>
    <app-album-toolbar
      [saving]="albumSaving"
      [findingUrl]="findingUrl"
      [renamingFolder]="renamingFolder"
      [trackTransferring]="trackTransferring"
      [folder]="album.folder"
      (save)="onSave()"
      (imageSearch)="onImageSearch()"
      (findUrl)="onFindUrl()"
      (renameFolder)="onRenameFolder()"
      (openFolder)="openFolder.emit(album.fullPath)"
      (transfer)="onTransferAlbum()"
      (delete)="deleteAlbum.emit(albumId)"
      (closeAlbum)="closeAlbum.emit()"
    ></app-album-toolbar>
  </nav>

  <ng-container *ngIf="trackSavingProgress || trackTransferringProgress || trackRenamingProgress as progress">
    <mat-progress-bar class="w-full h-3" mode="determinate" [value]="progress"> </mat-progress-bar>
  </ng-container>

  <form [formGroup]="form" autocomplete="off">
    <section class="flex flex-row">
      <app-cover [loading]="coverLoading" [cover]="album.cover" [coverError]="album.coverError" width="500" height="500" (coverUrl)="coverUrl.emit({ id: album.id, url: $event })"></app-cover>
      <mat-list class="m-2 summary-list">
        <mat-list-item class="mb-2">
          <mat-form-field class="w-full">
            <mat-label>Band</mat-label>
            <input matInput formControlName="artist" />
          </mat-form-field>
        </mat-list-item>
        <mat-list-item class="my-2">
          <mat-form-field class="w-full">
            <mat-label>Album</mat-label>
            <input matInput formControlName="album" />
          </mat-form-field>
        </mat-list-item>
        <mat-list-item class="my-2">
          <mat-form-field class="w-full">
            <mat-label>Genre</mat-label>
            <input matInput formControlName="genre" />
            <mat-icon *ngIf="artistUrl" matSuffix (click)="getBandProps(artistUrl)">music_note</mat-icon>
          </mat-form-field>
        </mat-list-item>
        <mat-list-item class="my-2">
          <mat-form-field class="w-full">
            <mat-label>Country</mat-label>
            <input matInput formControlName="country" />
            <mat-icon *ngIf="artistUrl" matSuffix (click)="getBandProps(artistUrl)">flag</mat-icon>
          </mat-form-field>
        </mat-list-item>
        <mat-list-item class="my-2">
          <mat-form-field class="w-full">
            <mat-label>Album Url</mat-label>
            <input matInput formControlName="albumUrl" />
            <mat-icon *ngIf="albumUrl" matSuffix (click)="openLink(albumUrl)">link</mat-icon>
          </mat-form-field>
        </mat-list-item>
        <mat-list-item class="my-2">
          <mat-form-field class="w-full">
            <mat-label>Artist Url</mat-label>
            <input matInput formControlName="artistUrl" />
            <mat-icon *ngIf="artistUrl" matSuffix (click)="openLink(artistUrl)">link</mat-icon>
          </mat-form-field>
        </mat-list-item>
        <mat-list-item class="mt-2">
          <mat-form-field class="w-10">
            <mat-label>Year</mat-label>
            <input matInput formControlName="year" />
          </mat-form-field>
        </mat-list-item>
        <mat-list-item>
          <mat-checkbox formControlName="transferred"> Transferred </mat-checkbox>
        </mat-list-item>
        <mat-list-item>
          <mat-checkbox formControlName="hasLyrics"> Lyrics </mat-checkbox>

          <div *ngIf="!hasLyrics" class="w-full text-right">
            <button mat-button class="p-0" (click)="lyricsPriority.emit(albumId)">
              <mat-icon>new_releases</mat-icon>
              <span class="ml-2">Priority</span>
            </button>
          </div>
        </mat-list-item>
      </mat-list>
    </section>

    <section>
      <app-tracks-toolbar
        [trackRenaming]="trackRenaming"
        [lyricsLoading]="lyricsLoading"
        [enableLyrics]="!!albumUrl"
        [albumDuration]="albumDuration"
        (maTracks)="onMaTracks()"
        (renameTracks)="onRenameTracks()"
        (lyrics)="onLyrics()"
        (refreshTracks)="refreshTracks.emit({ id: album.id, folder: album.folder })"
        (playAlbum)="playAlbum.emit(this.albumId)"
        (addAlbumToPlaylist)="addAlbumToPlaylist.emit(this.albumId)"
      >
      </app-tracks-toolbar>
      <app-tracks
        [form]="form"
        [tracksLoading]="tracksLoading"
        [tracks]="tracks"
        (transferTrack)="onTransferTrack($event)"
        (playTrack)="playTrack.emit({ track: $event, albumId: albumId })"
        (addTrackToPlaylist)="addTrackToPlaylist.emit({ track: $event, albumId: albumId })"
        (delete)="deleteTrack.emit({ track: $event, albumId: albumId })"
      ></app-tracks>
    </section>
  </form>
</ng-container>
