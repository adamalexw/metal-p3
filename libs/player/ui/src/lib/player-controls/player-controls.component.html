@if (footerMode()) {
  <div class="absolute bottom-[42px] left-0 w-full">
    <ng-container *ngTemplateOutlet="durationTemplate"></ng-container>
  </div>
}

<mat-toolbar class="relative h-full w-full">
  @if (!footerMode()) {
    <mat-toolbar-row>
      <div class="w-full">
        <div class="flex flex-row items-end pt-5">
          <span class="text-xs">{{ elapsedTime() | time }}</span>
          <span class="flex-grow"></span>
          <span class="text-xs">{{ currentItem()?.duration | time }}</span>
        </div>
        <ng-container *ngTemplateOutlet="durationTemplate"></ng-container>
      </div>
    </mat-toolbar-row>
  }
  <mat-toolbar-row class="-mr-16 !h-16 gap-2 lg:mr-0">
    <div class="flex h-full items-center" [ngClass]="{ 'w-full justify-center gap-2': !footerMode() }">
      <ng-container *ngTemplateOutlet="controlsTemplate"></ng-container>
    </div>
    @if (footerMode()) {
      <div class="hidden text-xs lg:block">{{ elapsedTime() | time }} / {{ currentItem()?.duration | time }}</div>
      @if (currentItem()) {
        <div class="mr-4 line-clamp-1 text-xs lg:mr-0">{{ currentItem()?.trackNumber }} - {{ currentItem()?.title }}</div>
      }
      <div class="absolute top-1/2 left-1/2 hidden -translate-x-1/2 -translate-y-1/2 transform lg:block">
        <ng-container *ngTemplateOutlet="detailsTemplate"></ng-container>
      </div>
    }
    <div class="absolute right-2 flex">
      <app-volume class="hidden lg:block" (volume)="volume.emit($event)" (mute)="mute.emit()" />
      <button class="ml-4 self-center leading-none" (click)="toggleView.emit()" mat-icon-button>
        <mat-icon mat-list-icon>{{ toggleIcon() }}</mat-icon>
      </button>
    </div>
  </mat-toolbar-row>
  @if (!footerMode()) {
    <ng-container>
      <mat-toolbar-row>
        @if (currentItem()) {
          <div class="w-full text-center">{{ currentItem()?.trackNumber }} - {{ currentItem()?.title }}</div>
        }
      </mat-toolbar-row>
      <mat-toolbar-row class="justify-center text-center">
        <ng-container *ngTemplateOutlet="detailsTemplate"></ng-container>
      </mat-toolbar-row>
    </ng-container>
  }
</mat-toolbar>

<ng-template #controlsTemplate>
  <button class="leading-none" [ngClass]="{ 'scale-150': !footerMode(), 'lg:scale-100': !footerMode() }" (click)="onPrevious()" mat-icon-button>
    <mat-icon mat-list-icon>skip_previous</mat-icon>
  </button>
  @if (!currentItem()?.playing) {
    <button class="leading-none" [ngClass]="{ 'scale-150': !footerMode(), 'lg:scale-100': !footerMode() }" (click)="playItem.emit()" mat-icon-button>
      <mat-icon mat-list-icon>play_arrow</mat-icon>
    </button>
  }
  @if (currentItem()?.playing) {
    <button class="leading-none" [ngClass]="{ 'scale-150': !footerMode(), 'lg:scale-100': !footerMode() }" (click)="pauseItem.emit()" mat-icon-button>
      <mat-icon mat-list-icon>pause</mat-icon>
    </button>
  }
  <button class="leading-none" [ngClass]="{ 'scale-150': !footerMode(), 'lg:scale-100': !footerMode() }" [disabled]="isLastItemPlaying()" (click)="next.emit()" mat-icon-button>
    <mat-icon mat-list-icon>skip_next</mat-icon>
  </button>
</ng-template>

<ng-template #detailsTemplate>
  <div class="flex-col text-center">
    @if (currentItem(); as currentItem) {
      <div class="text-sm">{{ currentItem.artist }} - {{ currentItem.album }}</div>
      <div class="text-sm">{{ currentItem.year }} - {{ currentItem.genre }}</div>
    }
  </div>
</ng-template>

<ng-template #durationTemplate>
  <mat-slider class="z-10 !m-0 !w-full" [max]="currentItem()?.duration" [disabled]="!currentItem()" min="0" step="1">
    <input [value]="elapsedTime()" (valueChange)="onSeek($event)" matSliderThumb />
  </mat-slider>
</ng-template>
