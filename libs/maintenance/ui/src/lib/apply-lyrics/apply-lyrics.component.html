<ng-container *ngIf="tracksLoading || maTracksLoading || lyricsLoadingProgress; else lyricsTemplate">
  <mat-progress-bar class="w-full h-3" [mode]="lyricsLoadingProgress ? 'determinate' : 'indeterminate'" [value]="lyricsLoadingProgress"> </mat-progress-bar>
  <h3>Loading Lyrics</h3>
</ng-container>

<ng-template #lyricsTemplate>
  <app-lyrics-toolbar
    [applying]="applying || false"
    [trackTransferring]="trackTransferring || false"
    [albumId]="albumId"
    [albumUrl]="albumUrl"
    [cover]="cover"
    [coverLoading]="coverLoading || false"
    [folder]="folder"
    [showClose]="showClose"
    (apply)="onApply()"
    (transfer)="onTransfer()"
    (done)="done.emit()"
  ></app-lyrics-toolbar>

  <ng-container *ngIf="applyingProgress || trackTransferringProgress as progress">
    <mat-progress-bar class="w-full h-3" mode="determinate" [value]="progress"> </mat-progress-bar>
  </ng-container>

  <mat-table [dataSource]="dataSource" [trackBy]="trackByFn">
    <ng-container matColumnDef="trackNumber">
      <mat-header-cell *matHeaderCellDef>#</mat-header-cell>
      <mat-cell *matCellDef="let element">
        {{ element.trackNumber }}
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="title">
      <mat-header-cell *matHeaderCellDef>Track</mat-header-cell>
      <mat-cell *matCellDef="let element">
        {{ element.title }}
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="duration">
      <mat-header-cell *matHeaderCellDef>Duration</mat-header-cell>
      <mat-cell *matCellDef="let element">
        {{ element.duration * 1000 | date: 'mm:ss':'UTC' }}
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="maTrack">
      <mat-header-cell *matHeaderCellDef>Lyrics</mat-header-cell>
      <mat-cell *matCellDef="let element" class="w-full">
        <mat-form-field floatLabel="never" class="w-full">
          <mat-label>Select lyrics track</mat-label>
          <mat-select [(value)]="element.maTrack">
            <mat-option>None</mat-option>
            <mat-option *ngFor="let track of maTracks" [value]="track">{{ track.trackNumber }} {{ track.title }} / {{ track.duration }} / {{ track.lyrics?.length || 0 }} </mat-option>
          </mat-select>
        </mat-form-field>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="selected">
      <mat-header-cell *matHeaderCellDef><mat-checkbox [checked]="true" (change)="onSelectAll($event.checked)"></mat-checkbox></mat-header-cell>
      <mat-cell *matCellDef="let element">
        <mat-checkbox [checked]="element.selected" (change)="onSelectItem(element.id, $event.checked)"></mat-checkbox>
      </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
  </mat-table>
</ng-template>
